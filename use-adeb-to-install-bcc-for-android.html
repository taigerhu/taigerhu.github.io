<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>使用 adeb 在 Android 上编译安装 bcc | TJ的技术博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">使用 adeb 在 Android 上编译安装 bcc</h1><a id="logo" href="/.">TJ的技术博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 首页</i></a><a href="/archives/"><i class="fa undefined"> 归档</i></a><a href="/about/"><i class="fa undefined"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">使用 adeb 在 Android 上编译安装 bcc</h1><div class="post-meta">2023-02-26</div><div class="post-content"><h2 id="先科普下-BCC"><a href="#先科普下-BCC" class="headerlink" title="先科普下 BCC"></a>先科普下 BCC</h2><p>BCC 官方：</p>
<blockquote>
<p>BCC is a toolkit for creating efficient kernel tracing and manipulation programs, and includes several useful tools and examples. It makes use of extended BPF (Berkeley Packet Filters), formally known as eBPF, a new feature that was first added to Linux 3.15. Much of what BCC uses requires Linux 4.1 and above.</p>
</blockquote>
<p>BCC 利用 eBPF 跟踪和操纵内核, 里面有很多工具。</p>
<p>Wiki eBPF:</p>
<blockquote>
<p>eBPF was built on top of the Berkeley Packet Filter (cBPF). At the lowest level, it introduced the use of ten 64-bit registers (instead of two 32-bit long registers for cBPF), different jump semantics, a call instruction and corresponding register passing convention, new instructions, and a different encoding for these instructions.[12] A number of additional features were subsequently added.</p>
</blockquote>
<p>eBPF 就是 BPF 的扩展版。</p>
<p>Wiki BPF 描述：</p>
<blockquote>
<p>BPF supports filtering packets, allowing a userspace process to supply a filter program that specifies which packets it wants to receive. For example, a tcpdump process may want to receive only packets that initiate a TCP connection. BPF returns only packets that pass the filter that the process supplies. This avoids copying unwanted packets from the operating system kernel to the process, greatly improving performance. The filter program is in the form of instructions for a virtual machine, which are interpreted, or compiled into machine code by a just-in-time (JIT) mechanism and executed, in the kernel.</p>
</blockquote>
<p>BPF 就是跑在内核里的虚拟机，使用 JIT 编译机制，最早用来过滤报文的。</p>
<p>Wiki JIT 编译解释：</p>
<blockquote>
<p>In computing, just-in-time (JIT) compilation (also dynamic translation or run-time compilations)<a href="https://tjtech.me/usr/uploads/2023/02/1630767984.png#center">1</a> is a way of executing computer code that involves compilation during execution of a program (at run time) rather than before execution</p>
</blockquote>
<p>JIT 是运行时编译。</p>
<blockquote>
<p>JIT compilation is a combination of the two traditional approaches to translation to machine code—ahead-of-time compilation (AOT), and interpretation—and combines some advantages and drawbacks of both.[2] </p>
</blockquote>
<p>Wiki AOT 编译：</p>
<blockquote>
<p>In computer science, ahead-of-time compilation (AOT compilation) is the act of compiling an (often) higher-level programming language into an (often) lower-level language before execution of a program, usually at build-time, to reduce the amount of work needed to be performed at run time.<br>AOT 编译是运行前编译 (like gcc)。</p>
</blockquote>
<h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><p>在 Android 上运行 BCC 可以选择安装 adeb，参考 <a target="_blank" rel="noopener" href="https://github.com/joelagnel/adeb/">https://github.com/joelagnel/adeb/</a> (不过现在不维护了，此为后话)</p>
<p>按官方文档 adeb prepare –build –bcc 带 BCC 编译安装时有如下错误，主机是 Ubuntu 18.04，板子安卓11, 内核 4.14。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">error: could not lock config file /home/tj/.gitconfig: No such file or directory</span><br><span class="line">CMake Warning at CMakeLists.txt:29 (message):</span><br><span class="line">  Failed to add root source directory to safe.directory</span><br></pre></td></tr></table></figure>

<p>这个半天没发现怎么 fix，转变思路，尝试直接从 BCC 源码编译，不过有如下错误：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">/home/tj/code/bcc/src/cc/bpf_module.cc: In member function ‘virtual void ebpf::MyMemoryManager::notifyObjectLoaded(llvm::ExecutionEngine*, const llvm::object::ObjectFile&amp;)’:</span><br><span class="line">/home/tj/code/bcc/src/cc/bpf_module.cc:121:46: error: no matching function for call to ‘llvm::object::SectionRef::getName() const’</span><br></pre></td></tr></table></figure>

<p>是最新版本 BCC 不支持 llvm6 了，可以使用版本 v0.24.0，编译果然没问题（也没有上面那个不能lock的问题），那直接把 adeb build 脚本改成这样最直接：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">diff --git a/buildstrap b/buildstrap</span><br><span class="line">index bdbc554..a25e67c 100755</span><br><span class="line">--- a/buildstrap</span><br><span class="line">+++ b/buildstrap</span><br><span class="line">@@ -61,7 +61,7 @@ echo &quot;nameserver 4.2.2.2&quot; &gt; $OUT_TMP/etc/resolv.conf</span><br><span class="line"></span><br><span class="line"> # Clone BCC if needed</span><br><span class="line"> if [ $INSTALL_BCC -eq 1 ]; then</span><br><span class="line">-       git clone https://github.com/iovisor/bcc.git $TDIR/debian/bcc-master</span><br><span class="line">+       git clone -b v0.24.0 https://github.com/iovisor/bcc.git $TDIR/debian/bcc-master</span><br><span class="line">        cp $spath/bcc/build-bcc.sh $TDIR/debian/bcc-master/</span><br><span class="line">        chroot $OUT_TMP /bcc-master/build-bcc.sh</span><br></pre></td></tr></table></figure>

<p>或者自行 checkout，clean 下 if needed. 一路下来，没有问题，能看到 bcc tools 已经安装上了:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">-- Installing: /usr/share/bcc/tools/javastat</span><br><span class="line">-- Installing: /usr/share/bcc/tools/javathreads</span><br><span class="line">-- Installing: /usr/share/bcc/tools/nodegc</span><br><span class="line">-- Installing: /usr/share/bcc/tools/nodestat</span><br><span class="line">-- Installing: /usr/share/bcc/tools/perlcalls</span><br><span class="line">-- Installing: /usr/share/bcc/tools/perlflow</span><br></pre></td></tr></table></figure>

<p>ok, 我们跑个工具看下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># opensnoop</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/usr/share/bcc/tools/opensnoop&quot;</span>, line 19, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from bcc import ArgString, BPF</span><br><span class="line">ImportError: No module named bcc</span><br></pre></td></tr></table></figure>

<p>少东西，默认安装的的 Debian buster，换个国内的源 (&#x2F;etc&#x2F;apt&#x2F;sources.list)，我用的 163:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">deb http://mirrors.163.com/debian/ buster main non-free contrib</span><br><span class="line">deb http://mirrors.163.com/debian/ buster-updates main non-free contrib</span><br><span class="line">deb http://mirrors.163.com/debian/ buster-backports main non-free contrib</span><br><span class="line">deb http://mirrors.163.com/debian-security/ buster/updates main non-free contrib</span><br><span class="line"></span><br><span class="line">deb-src http://mirrors.163.com/debian/ buster main non-free contrib</span><br><span class="line">deb-src http://mirrors.163.com/debian/ buster-updates main non-free contrib</span><br><span class="line">deb-src http://mirrors.163.com/debian/ buster-backports main non-free contrib</span><br><span class="line">deb-src http://mirrors.163.com/debian-security/ buster/updates main non-free contrib</span><br></pre></td></tr></table></figure>

<p>Android 系统连上网络后 <code>apt-get update</code> 更新没错后安装:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get install python-bpfcc</span><br></pre></td></tr></table></figure>

<p>不过这个竟然有错误：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">Err:1 http://mirrors.163.com/debian buster/main arm64 libbpfcc arm64 0.8.0-4</span><br><span class="line">  Temporary failure resolving &#x27;mirrors.163.com&#x27;</span><br><span class="line">Get:2 http://mirrors.163.com/debian buster/main arm64 python-bpfcc all 0.8.0-4 [29.4 kB]</span><br><span class="line">Fetched 29.4 kB in 11s (2710 B/s)</span><br><span class="line">E: Failed to fetch http://mirrors.163.com/debian/pool/main/b/bpfcc/libbpfcc_0.8.0-4_arm64.deb  Temporary failure resolving &#x27;mirrors.163.com&#x27;</span><br><span class="line">E: Unable to fetch some archives, maybe run apt-get update or try with --fix-missing?</span><br></pre></td></tr></table></figure>

<p>按提示用下面这个修复就好了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get install python-bpfcc --fix-missing</span><br></pre></td></tr></table></figure>

<p>最近 chatgpt 比较火，我也问了下，相比 web search，还是比较高效的。</p>
<p><img src="https://tjtech.me/usr/uploads/2023/02/1630767984.png#center" alt="chat-no-module-bcc.png"></p>
<p>再次运行出错如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># opensnoop</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/usr/share/bcc/tools/opensnoop&quot;</span>, line 19, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from bcc import ArgString, BPF</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/dist-packages/bcc/__init__.py&quot;</span>, line 27, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from .libbcc import lib, bcc_symbol, bcc_symbol_option, _SYM_CB_TYPE</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/dist-packages/bcc/libbcc.py&quot;</span>, line 20, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    lib.bpf_module_create_b.restype = ct.c_void_p</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/ctypes/__init__.py&quot;</span>, line 379, <span class="keyword">in</span> __getattr__</span><br><span class="line">    func = self.__getitem__(name)</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python2.7/ctypes/__init__.py&quot;</span>, line 384, <span class="keyword">in</span> __getitem__</span><br><span class="line">    func = self._FuncPtr((name_or_ordinal, self))</span><br><span class="line">AttributeError: /usr/lib/aarch64-linux-gnu/libbcc.so.0: undefined symbol: bpf_module_create_b</span><br></pre></td></tr></table></figure>

<p>是 python 默认版本 2.x 导致，切到 3.x：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># update-alternatives --install /usr/bin/python python /usr/bin/python2 1</span></span><br><span class="line">update-alternatives: using /usr/bin/python2 to provide /usr/bin/python (python) <span class="keyword">in</span> auto mode</span><br><span class="line">root@localhost:/<span class="comment"># update-alternatives --install /usr/bin/python python /usr/bin/python3 2</span></span><br><span class="line">update-alternatives: using /usr/bin/python3 to provide /usr/bin/python (python) <span class="keyword">in</span> auto mode</span><br><span class="line">root@localhost:/<span class="comment"># update-alternatives --config python</span></span><br><span class="line">There are 2 choices <span class="keyword">for</span> the alternative python (providing /usr/bin/python).</span><br><span class="line"></span><br><span class="line">  Selection    Path              Priority   Status</span><br><span class="line">------------------------------------------------------------</span><br><span class="line">* 0            /usr/bin/python3   2         auto mode</span><br><span class="line">  1            /usr/bin/python2   1         manual mode</span><br><span class="line">  2            /usr/bin/python3   2         manual mode</span><br><span class="line"></span><br><span class="line">Press &lt;enter&gt; to keep the current choice[*], or <span class="built_in">type</span> selection number: 2</span><br><span class="line">root@localhost:/<span class="comment">#</span></span><br><span class="line">root@localhost:/<span class="comment"># python</span></span><br><span class="line">Python 3.7.3 (default, Jan 22 2021, 20:04:44)</span><br><span class="line">[GCC 8.3.0] on linux</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; quit()</span><br></pre></td></tr></table></figure>

<p>再运行还有错：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># filetop</span></span><br><span class="line">sh: modprobe: <span class="built_in">command</span> not found</span><br><span class="line">Unable to find kernel headers. Try rebuilding kernel with CONFIG_IKHEADERS=m (module) or installing the kernel development package <span class="keyword">for</span> your running kernel version.</span><br><span class="line"><span class="built_in">chdir</span>(/lib/modules/4.14.xxx/build): No such file or directory</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/usr/share/bcc/tools/filetop&quot;</span>, line 164, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    b = BPF(text=bpf_text)</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bcc/__init__.py&quot;</span>, line 475, <span class="keyword">in</span> __init__</span><br><span class="line">    raise Exception(<span class="string">&quot;Failed to compile BPF module %s&quot;</span> % (src_file or <span class="string">&quot;&lt;text&gt;&quot;</span>))</span><br><span class="line">Exception: Failed to compile BPF module &lt;text&gt;</span><br></pre></td></tr></table></figure>

<p>modeprobe 命令找不到，安装：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get install kmod</span><br></pre></td></tr></table></figure>

<p>再跑出错：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># opensnoop</span></span><br><span class="line">modprobe: ERROR: ../libkmod/libkmod.c:586 kmod_search_moddep() could not open moddep file <span class="string">&#x27;/lib/modules/4.14.xxx/modules.dep.bin&#x27;</span></span><br><span class="line">modprobe: FATAL: Module kheaders not found <span class="keyword">in</span> directory /lib/modules/4.14.xxx</span><br><span class="line">Unable to find kernel headers. Try rebuilding kernel with CONFIG_IKHEADERS=m (module) or installing the kernel development package <span class="keyword">for</span> your running kernel version.</span><br><span class="line"><span class="built_in">chdir</span>(/lib/modules/4.14.xxx/build): No such file or directory</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/usr/share/bcc/tools/opensnoop&quot;</span>, line 261, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    b = BPF(text=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bcc/__init__.py&quot;</span>, line 475, <span class="keyword">in</span> __init__</span><br><span class="line">    raise Exception(<span class="string">&quot;Failed to compile BPF module %s&quot;</span> % (src_file or <span class="string">&quot;&lt;text&gt;&quot;</span>))</span><br><span class="line">Exception: Failed to compile BPF module &lt;text&gt;</span><br></pre></td></tr></table></figure>

<p>modprobe 找不到目录 &#x2F;lib&#x2F;modules&#x2F;4.14.xxx，看提示我的板子内核已经使能 CONFIG_IKHEADERS, 而且 linux header package 按下面命令搜索也没有匹配的包：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-cache search linux-headers-</span><br></pre></td></tr></table></figure>

<p>我们先来了解下 kernel header 相关修改：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">commit f63868480dd3c52324d9bb8cdabb7c9950e5f751</span><br><span class="line">Author: Joel Fernandes &lt;joelaf@google.com&gt;</span><br><span class="line">Date:   Wed Jul 10 22:52:30 2019 -0400</span><br><span class="line"></span><br><span class="line">    Remove all code todo with kernel headers or sources</span><br><span class="line"></span><br><span class="line">    BCC now can use headers from CONFIG_IKHEADERS so no need for adeb to</span><br><span class="line">    package them.</span><br><span class="line"></span><br><span class="line">    Signed-off-by: Joel Fernandes &lt;joelaf@google.com&gt;</span><br></pre></td></tr></table></figure>

<p>adeb 的 –kernel-src 是在 BCC 支持 <code>CONFIG_IKHEADERS</code> 前使用的，当前情况：</p>
<p>host: adeb(no –kernel-src) + bcc 0.24.0 (支持CONFIG_IKHEADERS)<br>target: CONFIG_IKHEADERS 已经使能</p>
<p>bcc v0.24.0 使用 sysfs:</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">commit 0797d4acbde025fbaa36e3c26257e74fb62645b2</span><br><span class="line">Author: Joel Fernandes (Google) &lt;joel@joelfernandes.org&gt;</span><br><span class="line">Date:   Wed Jun 12 15:54:14 2019 -0400</span><br><span class="line"></span><br><span class="line">    build: Rename kheaders location from proc to sys</span><br><span class="line"></span><br><span class="line">    In upstream kernel, the path has been renamed as the kheaders got moved</span><br><span class="line">    to sysfs. Let us update BCC with the new path.</span><br><span class="line"></span><br><span class="line">    Signed-off-by: Joel Fernandes (Google) &lt;joel@joelfernandes.org&gt;</span><br></pre></td></tr></table></figure>

<p>因为 CONFIG_IKHEADERS&#x3D;m 按模块编译，应该要加载这个模块，看看板子生成文件中确有 kheaders.ko，直接把这个 ko 推进板子上:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tj@u1804:~/adeb$ adeb push ~/kheaders.ko /data/</span><br><span class="line">|--------------|</span><br><span class="line">| adeb: v0.99h |</span><br><span class="line">|--------------|</span><br><span class="line">/home/tj/kheaders.ko: 1 file pushed. 26.1 MB/s (3279568 bytes <span class="keyword">in</span> 0.120s)</span><br></pre></td></tr></table></figure>

<p>然后 insmod 这个 ko:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># insmod /data/kheaders.ko</span></span><br></pre></td></tr></table></figure>

<p>确认：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># ls /sys/kernel/kheaders.tar.xz</span></span><br><span class="line">/sys/kernel/kheaders.tar.xz</span><br></pre></td></tr></table></figure>

<p>再运行出错：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># opensnoop</span></span><br><span class="line">tar (child): xz: Cannot <span class="built_in">exec</span>: No such file or directory</span><br><span class="line">tar (child): Error is not recoverable: exiting now</span><br><span class="line">tar: Child returned status 2</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br><span class="line">Unable to find kernel headers. Try rebuilding kernel with CONFIG_IKHEADERS=m (module) or installing the kernel development package <span class="keyword">for</span> your running kernel version.</span><br><span class="line"><span class="built_in">chdir</span>(/lib/modules/4.14.xxx/build): No such file or directory</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/usr/share/bcc/tools/opensnoop&quot;</span>, line 261, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    b = BPF(text=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bcc/__init__.py&quot;</span>, line 475, <span class="keyword">in</span> __init__</span><br><span class="line">    raise Exception(<span class="string">&quot;Failed to compile BPF module %s&quot;</span> % (src_file or <span class="string">&quot;&lt;text&gt;&quot;</span>))</span><br><span class="line">Exception: Failed to compile BPF module &lt;text&gt;</span><br></pre></td></tr></table></figure>

<p>这个看起来比较明显，直接安装 xz 命令包:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get install xz-utils</span><br></pre></td></tr></table></figure>

<p>now, it’s working.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@localhost:/<span class="comment"># opensnoop</span></span><br><span class="line">PID    COMM               FD ERR PATH</span><br><span class="line">792    vmstat              4   0</span><br><span class="line">792    vmstat              4   0</span><br><span class="line">792    vmstat              4   0</span><br><span class="line">792    vmstat              4   0</span><br><span class="line">792    vmstat              4   0</span><br><span class="line">792    vmstat              4   0</span><br><span class="line">792    vmstat              4   0</span><br><span class="line">792    vmstat              4   0</span><br></pre></td></tr></table></figure>

<p>btw: 同样的，可以安装bpftrace, build such as:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_C_COMPILER=clang-7 -DCMAKE_CXX_COMPILER=clang++-7 -DBUILD_TESTING=OFF</span><br></pre></td></tr></table></figure>

<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/joelagnel/adeb/blob/master/README.md">https://github.com/joelagnel/adeb/blob/master/README.md</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/iovisor/bcc/issues/3881">https://github.com/iovisor/bcc/issues/3881</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/iovisor/bcc/issues/4114">https://github.com/iovisor/bcc/issues/4114</a></li>
<li><a target="_blank" rel="noopener" href="https://lwn.net/Articles/783581/">Provide in-kernel headers to make extending kernel easier</a></li>
<li><a target="_blank" rel="noopener" href="https://lwn.net/ml/linux-kernel/20190320163116.39275-1-joel@joelfernandes.org/">https://lwn.net/ml/linux-kernel/20190320163116.39275-1-joel@joelfernandes.org/</a></li>
</ul>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>版权声明：</span>本站所有文章均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0 CN</a> 许可协议。转载请注明原文链接！</p></div><br><div class="tags"><a href="/tags/bcc"><i class="fa fa-tag">bcc</i></a><a href="/tags/adeb"><i class="fa fa-tag">adeb</i></a></div><div class="post-nav"><a class="pre" href="/how-to-support-workqueue-name-for-perf-sched.html">如何使 perf sched 支持 workqueue name</a><a class="next" href="/kworker-sched-la-stat.html">kworker 调度延迟性能测试和统计</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/upgrade-my-custom-build-server-amd-based.html">我的PC组装升级记</a></li><li class="post-list-item"><a class="post-list-link" href="/convert-typecho-to-hexo.html">I am back!</a></li><li class="post-list-item"><a class="post-list-link" href="/review-freezing-issue-when-drag-icon-after-ohos-adaption.html">OpenHarmony适配后图标拖拽卡屏问题回顾</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-fix-parse-too-complex-in-source-insight.html">Source Insight 自定义解析</a></li><li class="post-list-item"><a class="post-list-link" href="/adapt-ohos-for-mali-g57-on-sprd-t606.html">转：拥抱鸿蒙 - 在展讯T606平台上的探索与实践</a></li><li class="post-list-item"><a class="post-list-link" href="/essential-inventory-of-adaption-for-unisoc-platform-androidt-based.html">展讯平台 OpenHarmony 3.2.2 适配基础盘点</a></li><li class="post-list-item"><a class="post-list-link" href="/porting-openharmony-linux-kernel-to-3rd-party-chip.html">快速移植 OpenHarmony Linux 内核到三方 ARM64 平台</a></li><li class="post-list-item"><a class="post-list-link" href="/openharmony-linux-kernel-overview.html">初识 OpenHarmony Linux Kernel</a></li><li class="post-list-item"><a class="post-list-link" href="/what-android-gki-brings-to-oems.html">What Android GKI Brings to OEMs</a></li><li class="post-list-item"><a class="post-list-link" href="/analyze-erofs-pcluster-mode.html">转：EROFS pcluster 模式分析</a></li></ul></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/arm/">arm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dd/">dd</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ebpf/">ebpf</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fs/">fs</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iot/">iot</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mm/">mm</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/msm/">msm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ohos/">ohos</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/perf/">perf</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/stab/">stab</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">20</span></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">TJ的技术博客.</a></div></div></div><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>