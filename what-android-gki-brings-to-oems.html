<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>What Android GKI Brings to OEMs | TJ的技术博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">What Android GKI Brings to OEMs</h1><a id="logo" href="/.">TJ的技术博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 首页</i></a><a href="/archives/"><i class="fa undefined"> 归档</i></a><a href="/about/"><i class="fa undefined"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">What Android GKI Brings to OEMs</h1><div class="post-meta">2023-06-19</div><div class="post-content"><p>After reading the Android documentation on General Kernel Image (GKI), i have gained an understanding of what it means for OEMs.</p>
<p>We know every OEM could modify the Linux kernel in earlier kernel versions (before 5.4) of Android. Some were just customizing the device driver. However, Android realized that this process could block the ecosystem, so the GKI project was developed.</p>
<p>For OEMs, I think the key priority should be to differentiate the Linux kernel under GKI. However, most OEMs prefer not to submit their modifications to the Linux upstream as it is their proprietary and gives them a competitive edge (or show them may lead to a loss since they may not be solid enough). To address this, GKI offers a vendor hook method, which requires OEMs to create a separate kernel module for their modifications and add a hook in GKI that will call the functions defined in the kernel module. The hook uses kernel trace point rather trace event. By using this method, OEMs can differentiate their kernel while still maintaining their competitive advantage.</p>
<p>Please keep in mind that the OEM&#x2F;vendor must submit any hooks to the Android Common Kernel (ACK) upstream, which will then be reviewed. If the hook is reasonable, it will be accepted, but if it’s not, it will be rejected. It’s crucial to consider this when adding a hook to your feature since it could potentially be rejected.</p>
<p>Additionally, I’d like to point out that before the GKI was introduced, there were people who liked to make random modifications to the kernel. We weren’t sure whether these changes were good or bad because we weren’t familiar with the areas they were modifying. They simply had more exposure to those areas than we did. The emergence of GKI allows us to identify whether something is a mule or a horse.</p>
<p>Returning to the topic, are there any other ways to customize the kernel? I believe there are, and one example is eBPF. And i think we still need to submit something upstream rather than completely closed development.</p>
<p>Currently there are 2 GKI stages: GKI 1.0 and GKI 2.0.</p>
<blockquote>
<p>In GKI 1.0, devices launching with kernel version 5.4 must pass GKI testing (Android 11 and later platform releases).</p>
</blockquote>
<blockquote>
<p>In GKI 2.0, devices launching with kernel version 5.10 or higher must ship with the GKI kernel (beginning with Android 12). Signed boot images are available and updated regularly with LTS and critical bug fixes.</p>
</blockquote>
<p>Based on my undertanding, OEMs can still modify the core kernel for kernel 5.4 only if their devices pass the GKI testing and&#x2F;or CTS&#x2F;VTS testing. Remember, i think it’s best to avoid breaking the upgrade process which includes any core changes as well except this testing. If you’re not confident, don’t touch it. For kernel version 5.10 or above, it is mandatory that OEMs cannot modify the core kernel.</p>
<p>So, to summarize the methods that OEMs need to take towards the right direction:</p>
<ol>
<li>Develop a kernel module with a vendor hook.</li>
<li>Utilize eBPF technology.</li>
<li>Explore additional methods for customization.</li>
</ol>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference:"></a>Reference:</h2><ul>
<li><a target="_blank" rel="noopener" href="https://source.android.google.cn/docs/core/architecture/kernel/kernel-code">https://source.android.google.cn/docs/core/architecture/kernel/kernel-code</a></li>
</ul>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>版权声明：</span>本站所有文章均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0 CN</a> 许可协议。转载请注明原文链接！</p></div><br><div class="tags"><a href="/tags/Android"><i class="fa fa-tag">Android</i></a><a href="/tags/GKI"><i class="fa fa-tag">GKI</i></a></div><div class="post-nav"><a class="pre" href="/openharmony-linux-kernel-overview.html">初识 OpenHarmony Linux Kernel</a><a class="next" href="/analyze-erofs-pcluster-mode.html">转：EROFS pcluster 模式分析</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/review-freezing-issue-when-drag-icon-after-ohos-adaption.html">OpenHarmony适配后图标拖拽卡屏问题回顾</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-fix-parse-too-complex-in-source-insight.html">Source Insight 自定义解析</a></li><li class="post-list-item"><a class="post-list-link" href="/adapt-ohos-for-mali-g57-on-sprd-t606.html">转：拥抱鸿蒙 - 在展讯T606平台上的探索与实践</a></li><li class="post-list-item"><a class="post-list-link" href="/essential-inventory-of-adaption-for-unisoc-platform-androidt-based.html">展讯平台 OpenHarmony 3.2.2 适配基础盘点</a></li><li class="post-list-item"><a class="post-list-link" href="/porting-openharmony-linux-kernel-to-3rd-party-chip.html">快速移植 OpenHarmony Linux 内核到三方 ARM64 平台</a></li><li class="post-list-item"><a class="post-list-link" href="/openharmony-linux-kernel-overview.html">初识 OpenHarmony Linux Kernel</a></li><li class="post-list-item"><a class="post-list-link" href="/what-android-gki-brings-to-oems.html">What Android GKI Brings to OEMs</a></li><li class="post-list-item"><a class="post-list-link" href="/analyze-erofs-pcluster-mode.html">转：EROFS pcluster 模式分析</a></li><li class="post-list-item"><a class="post-list-link" href="/why-cpu-intensive-work-is-meaningless-for-unbound-wq.html">为什么 WQ_CPU_INTENSIVE 对 unbound 工作队列没有意义</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-support-filter-workqueue-name-in-bpftrace-runqlat.html">如何使 bpftrace:runqlat.bt 按 workqueue name 统计延迟</a></li></ul></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/arm/">arm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dd/">dd</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ebpf/">ebpf</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fs/">fs</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iot/">iot</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kernel/">kernel</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mm/">mm</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/msm/">msm</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ohos/">ohos</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/perf/">perf</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/stab/">stab</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">18</span></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">TJ的技术博客.</a></div></div></div><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>