<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Rockpi4b Armbian Kodi 终于能使用蓝牙了 | TJ的技术博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Rockpi4b Armbian Kodi 终于能使用蓝牙了</h1><a id="logo" href="/.">TJ的技术博客</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 首页</i></a><a href="/archives/"><i class="fa undefined"> 归档</i></a><a href="/about/"><i class="fa undefined"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Rockpi4b Armbian Kodi 终于能使用蓝牙了</h1><div class="post-meta">2022-05-08</div><div class="post-content"><p>这个板子以前我是这么用的：因眼馋搞了个官方指定的 NVMe (Acer那款，当时不到200块 128G) ，装了 Radxa 官方的 Debian stretch，不想落灰也想变美，就又搞了个铝外壳，不过 NVMe 装到壳子里，T卡就不能插拔了(貌似也不好装)，关键我T卡里装的是 LibreELEC，就这点精神食量，必须有，别问我为啥不用笔记本，这玩意小巧直接放到显示器旁，用时直接开关很方便，还减碳。那问题来了，难道要在这货上要装双系统？看了看有点复杂，不想弄了，所以只好将就把 NVMe 放到壳子下方，就可以插拔T卡了，不过总感觉有点别扭。</p>
<p>直到最近，发现一个叫 <a target="_blank" rel="noopener" href="https://twisteros.com/">TwisterOS</a> 的发行版其中有个特性正是我想要的：</p>
<blockquote>
<ul>
<li>Kodi and MPV media players with built-in hardware acceleration support</li>
</ul>
</blockquote>
<p>但是， Download 要fan，好吧，其他bt工具都无果，xunlei竟然能下，不过是体验的会员速度，内心焦灼，不就是10块钱嘛，我tao，下下来 Checksum 没问题，先备份数据，T卡启动<code>dd</code>直接刷xz：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo xzcat *.img.xz | pv | <span class="built_in">dd</span> of=/dev/nvme0n1 bs=1M</span><br></pre></td></tr></table></figure>

<p>拔掉T卡接上电源，哈哈哈，蓝灯闪了，启动了。体验了一下，有点失望，Kodi 直接飙到57度，室内也就20左右，记得以前 LibreELEC 好像都不超过45，可能是盖子问题，另外只开浏览器，RAM 就用的好多，官方也推荐用 4G RAM，感觉没必要，再加上这个 OS 蓝牙不能用，打算放弃，看Application，确实装的多了，还是用 Armbian 算了。</p>
<p>既然决定用 Armbian 就搜了下竟然被我发现了，那就是 <a target="_blank" rel="noopener" href="https://forum.armbian.com/topic/16516-rk3399-legacy-multimedia-framework/">RK3399 有个 legacy multimedia 包</a>，已经被集成到 Armbian 官方 Debian buster发行版了，这个 legacy 说的就是内核旧点(kernel-4.4)。赶紧到 <a target="_blank" rel="noopener" href="https://imola.armbian.com/archive/rockpi-4b/archive/">Armbian download</a> 里下载 Armbian_21.08.1_Rockpi-4b_buster_legacy_4.4.213_xfce_desktop.img.xz (当前最新)，因 kernel 是 4.4，蓝牙应该正常，源更新时不需要 apt upgrade 防止挂掉费时折腾，我用的是<a target="_blank" rel="noopener" href="http://mirrors.ustc.edu.cn/help/debian.html">ustc</a>。</p>
<h2 id="安装多媒体框架"><a href="#安装多媒体框架" class="headerlink" title="安装多媒体框架"></a>安装多媒体框架</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install media-buster-legacy-rk3399 --install-recommends</span><br></pre></td></tr></table></figure>

<p>安装完后不要 <code>systemctl disable lightdm</code> 禁用lightdm，恢复又要折腾，只需要logout，在登陆界面菜单选择Kodi-GBM就可以了。</p>
<h2 id="USB-移动硬盘不能自动-mount"><a href="#USB-移动硬盘不能自动-mount" class="headerlink" title="USB 移动硬盘不能自动 mount"></a>USB 移动硬盘不能自动 mount</h2><p>不想改fstab，LibreELEC 都是自动识别的，查了下是缺 usbmount 这个包，ubuntu有debian丢了，git clone then build 出一个deb，另我的移动硬盘是 NTFS 格式，只需要在&#x2F;etc&#x2F;usbmount&#x2F;usbmount.config里添加 ntfs 和 fuseblk 到文件系统支持列表里就行了：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">FILESYSTEMS=&quot;vfat ext2 ext3 ext4 hfsplus ntfs fuseblk&quot;</span><br></pre></td></tr></table></figure>
<p>盖上盖子，看了下die温度基本&lt;45, ok，完美。最后一步，来看 Kodi 如何使用蓝牙耳机：</p>
<h2 id="如何在-Kodi-下使用蓝牙耳机"><a href="#如何在-Kodi-下使用蓝牙耳机" class="headerlink" title="如何在 Kodi 下使用蓝牙耳机"></a>如何在 Kodi 下使用蓝牙耳机</h2><p>官方论坛有个<a target="_blank" rel="noopener" href="https://forum.kodi.tv/showthread.php?tid=348258">帖子</a>说到：</p>
<blockquote>
<p>Bluetooth “receiver” functionality has to be done at OS level and has nothing to do with Kodi.<br>Kodi does not handle bluetooth at all, “bluetooth settings” you might see in LibreELEC is a part of a LE specific addon and is not present in vanilla Kodi.</p>
</blockquote>
<p>是的，Kodi 是作为一个 App 存在于 OS里。音频输出我不关心蓝牙，那是你的发行版需要关心的东西，所以不要因 LibreELEC 里有蓝牙配对就对我指手画脚。</p>
<p>ok, 那先把 Armbian 的蓝牙搞定，进lightdm, 果然<code>hciconfig</code>空空如也。</p>
<p>radax 官方 wiki 也是，buster 的都没有写，只写了 stretch 的，那玩意真的不准，费力啊。我们来看看，<a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rockpi4/Debian#Using_Bluetooth">根据提示</a>要装broadcom-wifibt-firmware 和 rockpi4-brcm-patch 两个包，看 stretch 用的 testing，一开始我选了 buster-testing，好家伙找不到，后来还是去 <a target="_blank" rel="noopener" href="https://github.com/radxa/apt/tree/gh-pages/buster-stable/pool/main">radax 的 github apt仓</a> 看了下果然没有，是放到了buster-stable里，更正后却只有broadcom-wifibt-firmware，而没有 rockpi4-brcm-patch，取代的是安装了 brcm-patchram-plus1 这个包。nd，<code>hciconfig</code>还是没货，直到<a target="_blank" rel="noopener" href="https://forum.radxa.com/t/ubuntu-server-image-no-bluetooth/160/13">发现一个帖子</a>提到要这个工具跑下，照着做果然<code>hciconfig</code>有输出了，如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tj@rockpi-4b:~$ hciconfig </span><br><span class="line">hci0:	Type: Primary  Bus: UART</span><br><span class="line">	BD Address: xx:xx:xx:xx:xx:xx  ACL MTU: 1021:8  SCO MTU: 64:1</span><br><span class="line">	UP RUNNING PSCAN </span><br><span class="line">	RX bytes:890 acl:0 sco:0 events:64 errors:0</span><br><span class="line">	TX bytes:5005 acl:0 sco:0 commands:64 errors:0</span><br></pre></td></tr></table></figure>

<p>radxa啊radxa，你就不能写个wiki嘛，等我有空来写？ 现在没空，赶紧拿出我心爱的漫步者耳麦，searching，配对，哈哈，it works。那 Kodi 咋用呢，摸索了下就是蓝牙连上后不要超时断开直接退出 lightdm 进 Kodi-GBM 就可以了，Kodi 音频输出设备里会多出一个蓝牙耳机的选项，选中它，哈哈，和 LibreELEC 一样一样的，装进我的外壳里，搞定。</p>
<h2 id="备份系统"><a href="#备份系统" class="headerlink" title="备份系统"></a>备份系统</h2><p>好不容易装好了，防止夜长了点，来备份吧，<code>dd</code>是备份整个disk，不合适大磁盘(我就没分区，简单啊，先用起来。。。)。<a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rockpi4/backup#Using_Rockpi4">官方的脚本</a>说是备份真实使用数据，用了下还是备份整个磁盘，估计有bug，没细看了。用原始<code>cp</code>方法吧，参考这个<a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/BackupYourSystem/TAR">帖子</a>:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">tar -cvpzf /home/tj/backup.tar.gz --exclude=/home/tj/backup.tar.gz --one-file-system / </span><br></pre></td></tr></table></figure>

<p>还是nvme快啊，分分钟搞定。</p>
<h2 id="装个散热风扇"><a href="#装个散热风扇" class="headerlink" title="装个散热风扇"></a>装个散热风扇</h2><p>这不快到6.1了吗，吹着风扇肯定双啊，我也能多起几个worker，装到壳子里面看来是没戏了，装外面吧，想了想，这货孔位兼容树莓派(raspberry pi)，逛了逛xbao，树莓派的外壳可真是琳琅满目啊，终于发现一款给集群用的简易亚克力外壳，中间层有风扇正好(幸好我螺丝多-_-!)，看看美图：</p>
<p><img src="https://tjtech.me/usr/uploads/2022/05/1026616912.png" alt="tj-rockpi4-case.png"></p>
<p>怎么能让它一直转悠！稍微吵了，尤其夜深时分。接3.3V，挂个三极管温控一把，美美的，gpio控制用<a target="_blank" rel="noopener" href="https://wiki.radxa.com/Rockpi4/dev/libmraa">libmraa</a>。</p>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>版权声明：</span>本站所有文章均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0 CN</a> 许可协议。转载请注明原文链接！</p></div><br><div class="tags"><a href="/tags/rockpi4"><i class="fa fa-tag">rockpi4</i></a></div><div class="post-nav"><a class="pre" href="/analyze-fscache-cookie-code.html">转：浅析 Linux FS-Cache</a><a class="next" href="/erofs-ztailpacking-explain.html">转：EROFS ztailpacking 特性实现详解</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/kworker-sched-la-stat.html">kworker 调度延迟性能测试和统计</a></li><li class="post-list-item"><a class="post-list-link" href="/implement-erofs-fragment-dedupe.html">转：EROFS 碎片去重实践</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-enable-kasan-in-ubuntu-18-04-for-x86_64.html">How to enable KASAN in Ubuntu 18.04 for X86_64</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-analyze-segmentation-fault-for-non-install-package-in-ubuntu.html">如何分析 Linux user space's segmentation fault</a></li><li class="post-list-item"><a class="post-list-link" href="/prepare-fragment-dedupe-in-erofs.html">EROFS 碎片去重准备</a></li><li class="post-list-item"><a class="post-list-link" href="/good-naming-in-programming.html">优秀代码命名法</a></li><li class="post-list-item"><a class="post-list-link" href="/erofs-compressed-data-deduplication.html">EROFS 压缩去重分析</a></li><li class="post-list-item"><a class="post-list-link" href="/analyze-fscache-cookie-code.html">转：浅析 Linux FS-Cache</a></li><li class="post-list-item"><a class="post-list-link" href="/how-to-let-bluetooth-work-under-armbian-kodi-for-rockpi4b-within-metal-case.html">Rockpi4b Armbian Kodi 终于能使用蓝牙了</a></li><li class="post-list-item"><a class="post-list-link" href="/erofs-ztailpacking-explain.html">转：EROFS ztailpacking 特性实现详解</a></li></ul></div><div class="widget"><div class="widget-title">分类</div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/arm/">ARM</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/dd/">Device Driver</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/fs/">File System</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iot/">IoT</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/msm/">MSM</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mm/">Memory Management</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/perf/">Performance</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">Security</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/stab/">Stability</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">Tools</a><span class="category-list-count">17</span></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">TJ的技术博客.</a></div></div></div><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>